/*!
* Tim
*   github.com/premasagar/tim
*
*//*
    A tiny, secure JavaScript micro-templating script.
*/
var tim=function createTim(x){function y(){q=RegExp(i.start+"\\s*("+i.path+")\\s*"+i.end,"gi")}function z(a){var b;if(a){for(b in a)a.hasOwnProperty(b)&&(i[b]=a[b]);y()}return i}function t(a,b){var c;switch(typeof a){case "string":if(b===r)return k[a]||"";else b===!1?delete k[a]:k[a]=b;break;case "object":for(c in a)a.hasOwnProperty(c)&&t(c,a[c]);break;case "boolean":a||(k={})}return k}function C(a,b){return a[1]-b[1]}function n(a,b,c){var e=v[a];e||(e=v[a]=[]);e.push([b,c||0]);e.sort(C);return b}
function l(a,b){var c=v[a],e,d,f,g;if(c){e=[b];d=2;for(f=arguments.length;d<f;d++)e.push(arguments[d]);d=0;for(f=c.length;d<f;d++)if(e[0]=b,g=c[d][0].apply(null,e),b!==r&&g!==r&&(b=g),w){w=!1;break}}return b}function A(a,b){return(typeof b==="function"?n:l).apply(null,arguments)}function m(a,b){var c;B||(B=1,l("init"));a=l("templateBefore",a);a.indexOf(i.start)<0&&(c=t(a))&&(a=c);if((a=l("template",a))&&b!==r){c=a;for(var e,d,f,g,h,j,k,o,s,p,n;(e=q.exec(c))!==null;){d=e[1];f=l("token",d,b,c);g=e.index;
e=q.lastIndex;g=c.slice(0,g);h=c.slice(e);typeof f==="function"&&(f=f.call(b));if(typeof f!=="boolean"&&typeof f!=="object")c=g+f+h;else if(j="",k=i.start+"/"+d+i.end,o=h.indexOf(k),o>=0){h=h.slice(0,o);if(typeof f==="boolean")j=f?h:"";else{for(s in f)if(f.hasOwnProperty(s)){q.lastIndex=0;p={_key:s,_content:f[s]};o=f[s];var u=void 0;for(u in o)o.hasOwnProperty(u)&&(p[u]=o[u]);p=l("loopData",p,n,d);n=m(h,p);j+=l("loop",n,d,p)}j=l("loopEnd",j,d,p)}c=g+j+c.slice(e+h.length+k.length)}else throw"tim: '"+
d+"' not closed";q.lastIndex=0}a=c}return a=l("templateAfter",a)}var i={start:"{{",end:"}}",path:"[a-z0-9_][\\.a-z0-9_]*"},k={},v={},w,q,B,r;x?z(x):y();A.stop=function(){w=!0};m.settings=z;m.templates=t;m.parser=createTim;m.filter=A;n("token",function(a,b,c){for(var a=a.split("."),e=a.length,d=0;d<e;d++){b=b[a[d]];if(b===r)throw"tim: '"+a[d]+"' not found"+(d?" in "+c:"");if(d===e-1)return b}});if(window&&window.document)m.dom=function(a){for(var a=a||{},b=a.type||i.type||"text/tim",a=a.attr||i.attr||
"class",c=window.document,e=!!c.querySelectorAll,c=e?c.querySelectorAll("script[type='"+b+"']"):c.getElementsByTagName("script"),d=0,f=c.length,g,h,j={};d<f;d++)if(g=c[d],(h=a==="class"?g.className:g.getAttribute(a))&&(e||g.type===b))j[h]=g.innerHTML;t(j);return j},n("init",function(){m.dom()});return m}();
